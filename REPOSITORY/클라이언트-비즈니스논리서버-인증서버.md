> 클라이언트가 비즈니스 논리 서버에서 제공하는 엔드포인트를 호출하기 위해서는 다음의 단계를 따라야 함

단계 1. 1차 사용자 인증 w/ 사용자 ID/PW
- 비즈니스 논리 서버에서 제공하는 /login 엔드포인트를 호출함
- 이 때, 사용자 ID와 PW를 비즈니스 논리 서버로 전달함
- 인증에 성공하면 OTP를 얻음

단계 2. 2차 사용자 인증 w/ OTP
- 전달받은 OTP와 사용자 ID로 /login 엔드포인트를 호출함
- 이 단계가 성공하면 토큰을 얻음

단계 3. 토큰 기반의 엔드포인트 호출
- 비즈니스 논리서버에서 제공하는 다른 엔드포인트를 호출할 때 토큰을 함께 전달함
- 2단계에서 얻은 토큰을 HTTP 요청의 Authorization 헤더에 추가해서 엔드포인트를 호출함


![[Pasted image 20250512205110.png]]
![[Pasted image 20250512205249.png]]


#### 토큰이란
특정 엔드포인트에 접근하려는 클라이언트가 HTTP 헤더를 통해 전달하는 문자열이다.
- UUID 처럼 단순한 문자열일수도 있고,
- JWT(Json Web Token)처럼 조금 더 복잡한 형식으로 구성될 수도 있음

비유를 하면, 호텔 출입문 카드와 비슷함
- 모든 사람은 호텔방에 접근할 수 없지만
- 호텔방을 예약한 사람만 접근할 수 있는 권한이 생기고, 체크인 과정을 통해 특정 방에 접근할 수 있는 호텔 출입문 카드를 얻음
- 호텔이 허용한 방에만 해당 출입문 카드로 접근할 수 있음
- 출입문 카드가 있다고 하더라도, 모든 방에 대한 접근 권한이 생기는 것은 아니다. 

##### 장점 
- 토큰을 이용하면 요청할 때마다 자격증명을 공유할 필요가 없음
- 토큰의 수명을 짧게 지정할 수 있음
- 자격증명을 무표로 하지 않고 토큰을 무효로 할 수 있음
- 클라이언트가 요청할 때 보내야하는 사용자 권한과 같은 세부 정보를 토큰에 저장할 수 있음
- 토큰을 이용하면 인증 책임을 시스템의 다른 구성 요소에 위임할 수 있음

##### JWT
> JWT는 JSON Web Token 의 약자로, 애플리케이션에서 많이 사용되는 토큰 중 하나

- UUID 는 일반적인 문자열이지만 JWT 는 세 부분으로 구성되어 있고 각 부분은 마침표로 구분됨
- 헤더.본문.디지털 서명으로 구성
	- 헤더
		- JSON
		- Base64 인코딩
		- 세부정보 저장
		- 토큰과 관련된 메타 데이터 저장
		- 서명을 생성하는데 이용한 알고리즘의 이름이 저장될수도
	- 본문
		- JSON
		- Base64 인코딩
		- 일련번호, 사용자 이름, 시간 등 저장
	- 디지털서명
		- 생략이 되어 버리면 네트워크에서 토큰을 전송할 때 보낸 발송자를 확인할 수 없음
		- 따라서 통신 과정에서 토큰이 가로채어져 토큰 내용이 변경되었는지에 대한 확신을 줄 수 없음

토큰은 짧게 유지하는 것이 좋고, 본문에는 많은 데이터를 추가하지 않는것이 좋음. 최대한 심플하게
길이에 대한 제한은 없지만 길이가 너무 길면 요청 속도가 느려지며 암호화 알고리즘이 서명하는 시간도 길어짐